# This file is dynamically generated by deploy.sh
# DO NOT EDIT MANUALLY if you intend to use the script for future deployments.

steps:
- name: 'gcr.io/cloud-builders/docker'
  id: 'Build and Tag Image'
  args: ['build', '-t', 'us-central1-docker.pkg.dev/handsonlabor/cloud-run-images/holitime:20250705-023433', '.']

- name: 'gcr.io/cloud-builders/docker'
  id: 'Push Image to Registry'
  args: ['push', 'us-central1-docker.pkg.dev/handsonlabor/cloud-run-images/holitime:20250705-023433']

- name: 'gcr.io/cloud-builders/gcloud'
  id: 'Deploy to Cloud Run'
  args:
  - 'run'
  - 'deploy'
  - 'holitime'
  - '--image'
  - 'us-central1-docker.pkg.dev/handsonlabor/cloud-run-images/holitime:20250705-023433'
  - '--platform'
  - 'managed'
  - '--region'
  - 'us-central1'
  - '--allow-unauthenticated'
  - '--port'
  - '3000'
  - '--memory'
  - '4Gi'
  - '--cpu'
  - '4'
  - '--min-instances'
  - '0'
  - '--max-instances'
  - '2'
  - '--timeout'
  - '300'
  - '--concurrency'
  - '80'
  - '--update-env-vars'
  - 'NODE_ENV=production'
  - '--update-env-vars'
  - 'NEXT_TELEMETRY_DISABLED=1'
  - '--update-env-vars'
  - 'DATABASE_URL=postgres://avnadmin:AVNS_ZM2GXlIMUITHMcxFPcy@holidb-hol619.d.aivencloud.com:12297/defaultdb?sslmode=require'
  - '--update-env-vars'
  - 'DATABASE_PROVIDER=aiven'
  - '--update-env-vars'
  - 'DATABASE_SSL=true'
  - '--update-env-vars'
  - 'NODE_TLS_REJECT_UNAUTHORIZED=0'
  - '--update-env-vars'
  - 'NEXTAUTH_SECRET=holitime-super-secure-secret-key-for-production-2024'
  - '--update-env-vars'
  - 'NEXTAUTH_URL=https://holitime-369017734615.us-central1.run.app'
  - '--update-env-vars'
  - 'GOOGLE_CLIENT_ID=369017734615-d69l9fi2bphahlk815ji447ri2m3qjjp.apps.googleusercontent.com'
  - '--update-env-vars'
  - 'GOOGLE_CLIENT_SECRET=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'
  - '--update-env-vars'
  - 'JWT_SECRET=holitime-jwt-secret-key-for-production-2024'
  - '--update-env-vars'
  - 'SMTP_HOST=smtp.gmail.com'
  - '--update-env-vars'
  - 'SMTP_PORT=587'
  - '--update-env-vars'
  - 'SMTP_USER=ryley92@gmail.com'
  - '--update-env-vars'
  - 'SMTP_PASS=bhxfntiblfatdlep'
  - '--update-env-vars'
  - 'GOOGLE_AI_API_KEY=AIzaSyDb8Qj6GKxUL1I2Stgv1B0gSTDOj0FB6k'
  - '--update-env-vars'
  - 'GOOGLE_API_KEY=AIzaSyAaMQ6qq0iVnyt2w1IERTPwXGrllSLnhZQ'
  - '--update-env-vars'
  - 'GEMINI_API_KEY=AIzaSyDAUHnUgtT1SXmZt6J1Rs6JqirVMSHQNtc'
  - '--project'
  - 'handsonlabor'

# Define the images that will be built and pushed by this build
images:
- 'us-central1-docker.pkg.dev/handsonlabor/cloud-run-images/holitime:20250705-023433'

options:
  logging: CLOUD_LOGGING_ONLY
  machineType: 'E2_HIGHCPU_8'

timeout: '1200s'
